# 소프트웨어 개발 보안

안전한 소프트웨어 개발을 위한 보안 원칙과 시큐어 코딩에 대해 학습합니다.

---

## 소프트웨어 개발 보안 개요

### 정의

| 항목 | 설명 |
|------|------|
| 소프트웨어 개발 보안 | 개발 전 과정에서 보안 취약점을 사전에 제거 |
| 시큐어 코딩 | 보안 취약점이 없는 안전한 코드 작성 |
| Secure SDLC | 보안이 통합된 소프트웨어 개발 생명주기 |

### 필요성

| 이유 | 설명 |
|------|------|
| 비용 절감 | 개발 단계 보안이 운영 단계보다 저렴 |
| 품질 향상 | 보안 결함 감소 |
| 규정 준수 | 법적 요구사항 충족 |
| 신뢰 확보 | 사용자 신뢰 향상 |

---

## Secure SDLC

### SDLC 보안 활동

| 단계 | 보안 활동 |
|------|----------|
| 요구사항 | 보안 요구사항 정의, 위협 모델링 |
| 설계 | 보안 아키텍처, 보안 설계 검토 |
| 구현 | 시큐어 코딩, 코드 리뷰 |
| 테스트 | 보안 테스트, 취약점 스캔 |
| 배포 | 보안 설정, 최종 검토 |
| 운영 | 모니터링, 패치 관리 |

### 주요 Secure SDLC 모델

| 모델 | 설명 |
|------|------|
| MS SDL | Microsoft Security Development Lifecycle |
| OWASP SAMM | Software Assurance Maturity Model |
| BSIMM | Building Security In Maturity Model |
| CLASP | OWASP Comprehensive Lightweight Application Security Process |

### MS SDL 단계

| 단계 | 활동 |
|------|------|
| 교육 | 보안 교육 |
| 요구사항 | 보안 요구사항, 품질 게이트 |
| 설계 | 위협 모델링, 공격 표면 분석 |
| 구현 | 시큐어 코딩, 정적 분석 |
| 검증 | 동적 분석, 퍼징, 침투 테스트 |
| 릴리스 | 최종 보안 검토, 사고 대응 계획 |
| 대응 | 보안 사고 대응 |

---

## 위협 모델링

### 위협 모델링 개요

| 항목 | 설명 |
|------|------|
| 정의 | 시스템의 보안 위협을 체계적으로 식별 |
| 목적 | 설계 단계에서 보안 취약점 발견 |
| 산출물 | 위협 목록, 대응 방안 |

### STRIDE 모델

| 위협 | 설명 | 보안 속성 |
|------|------|----------|
| Spoofing | 신원 위조 | 인증 |
| Tampering | 데이터 변조 | 무결성 |
| Repudiation | 부인 | 부인 방지 |
| Information Disclosure | 정보 노출 | 기밀성 |
| Denial of Service | 서비스 거부 | 가용성 |
| Elevation of Privilege | 권한 상승 | 인가 |

### DREAD 모델 (위험도 평가)

| 요소 | 설명 |
|------|------|
| Damage | 피해 규모 |
| Reproducibility | 재현 가능성 |
| Exploitability | 공격 용이성 |
| Affected Users | 영향받는 사용자 수 |
| Discoverability | 발견 가능성 |

### 위협 모델링 프로세스

| 단계 | 설명 |
|------|------|
| 1 | 시스템 이해 (DFD 작성) |
| 2 | 위협 식별 (STRIDE 적용) |
| 3 | 위험도 평가 (DREAD) |
| 4 | 대응 방안 수립 |
| 5 | 검증 |

---

## 시큐어 코딩 가이드

### 입력 데이터 검증

#### 검증 원칙

| 원칙 | 설명 |
|------|------|
| 화이트리스트 | 허용된 값만 승인 |
| 서버 측 검증 | 클라이언트 검증만으로 불충분 |
| 정규화 | 검증 전 데이터 정규화 |
| 이스케이프 | 출력 시 이스케이프 처리 |

#### 입력 검증 체크리스트

| 항목 | 설명 |
|------|------|
| 길이 | 최대/최소 길이 제한 |
| 타입 | 예상 데이터 타입 검증 |
| 범위 | 허용 값 범위 검증 |
| 형식 | 정규표현식 패턴 검증 |
| 문자 | 특수문자, 제어문자 필터링 |
| 인코딩 | 문자 인코딩 검증 |

#### 취약한 코드 예시

```java
// 취약: 입력값 직접 사용
String userId = request.getParameter("userId");
String query = "SELECT * FROM users WHERE id = '" + userId + "'";

// 안전: PreparedStatement 사용
String userId = request.getParameter("userId");
PreparedStatement stmt = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
stmt.setString(1, userId);
```

### 출력 인코딩

| 컨텍스트 | 인코딩 방식 |
|---------|------------|
| HTML 본문 | HTML Entity 인코딩 |
| HTML 속성 | 속성 인코딩 |
| JavaScript | JavaScript 인코딩 |
| URL | URL 인코딩 |
| CSS | CSS 인코딩 |
| SQL | Prepared Statement |

```java
// HTML 인코딩
String safe = ESAPI.encoder().encodeForHTML(userInput);

// JavaScript 인코딩
String safe = ESAPI.encoder().encodeForJavaScript(userInput);

// URL 인코딩
String safe = URLEncoder.encode(userInput, "UTF-8");
```

### 인증 및 세션 관리

#### 안전한 인증

| 항목 | 권장 사항 |
|------|----------|
| 패스워드 저장 | bcrypt, Argon2, PBKDF2 해시 |
| 다중 인증 | MFA 구현 |
| 계정 잠금 | 실패 횟수 제한 |
| 패스워드 정책 | 복잡도, 길이, 히스토리 |
| 안전한 복구 | 토큰 기반 재설정 |

```java
// 취약: MD5 해시
String hash = DigestUtils.md5Hex(password);

// 안전: bcrypt
String hash = BCrypt.hashpw(password, BCrypt.gensalt(12));
boolean valid = BCrypt.checkpw(password, storedHash);
```

#### 안전한 세션 관리

| 항목 | 권장 사항 |
|------|----------|
| 세션 ID 생성 | 암호학적으로 안전한 난수 |
| 세션 ID 재생성 | 로그인 시 새 세션 ID |
| 세션 타임아웃 | 적절한 만료 시간 |
| 쿠키 속성 | HttpOnly, Secure, SameSite |
| 로그아웃 | 서버 측 세션 무효화 |

### 접근 제어

| 원칙 | 설명 |
|------|------|
| 기본 거부 | 명시적 허용 외 차단 |
| 최소 권한 | 필요한 최소 권한만 |
| 권한 분리 | 역할별 권한 분리 |
| 서버 측 검증 | 모든 요청 권한 검증 |
| 직접 참조 방지 | 간접 참조 사용 |

```java
// 취약: 직접 객체 참조
@GetMapping("/documents/{id}")
public Document getDocument(@PathVariable Long id) {
    return documentService.findById(id); // 권한 검증 없음
}

// 안전: 권한 검증
@GetMapping("/documents/{id}")
public Document getDocument(@PathVariable Long id, @AuthenticationPrincipal User user) {
    Document doc = documentService.findById(id);
    if (!doc.getOwner().equals(user)) {
        throw new AccessDeniedException("Access denied");
    }
    return doc;
}
```

### 암호화

#### 암호화 권장 사항

| 항목 | 권장 | 비권장 |
|------|------|--------|
| 대칭키 암호화 | AES-256 | DES, 3DES, RC4 |
| 해시 | SHA-256, SHA-3 | MD5, SHA-1 |
| 패스워드 해시 | bcrypt, Argon2 | 일반 해시 |
| 비대칭키 | RSA-2048+, ECDSA | RSA-1024 |
| 프로토콜 | TLS 1.2+ | SSL, TLS 1.0/1.1 |

#### 안전한 난수 생성

```java
// 취약: 예측 가능한 난수
Random random = new Random();
String token = String.valueOf(random.nextInt());

// 안전: 암호학적 난수
SecureRandom secureRandom = new SecureRandom();
byte[] bytes = new byte[32];
secureRandom.nextBytes(bytes);
String token = Base64.getEncoder().encodeToString(bytes);
```

### 에러 처리

| 원칙 | 설명 |
|------|------|
| 정보 노출 방지 | 상세 에러 메시지 숨김 |
| 일관된 에러 | 인증 실패 시 동일 메시지 |
| 로깅 | 상세 에러는 로그에 기록 |
| 안전한 실패 | 에러 시 안전한 상태 유지 |

```java
// 취약: 상세 에러 노출
catch (SQLException e) {
    response.getWriter().write("Error: " + e.getMessage());
}

// 안전: 일반 에러 메시지
catch (SQLException e) {
    logger.error("Database error", e);
    response.getWriter().write("An error occurred. Please try again.");
}
```

### 로깅 및 모니터링

#### 로깅 대상

| 대상 | 예시 |
|------|------|
| 인증 이벤트 | 로그인 성공/실패 |
| 권한 변경 | 역할 부여/회수 |
| 데이터 접근 | 민감 데이터 조회 |
| 시스템 이벤트 | 설정 변경, 시작/종료 |
| 보안 이벤트 | 공격 시도, 차단 |

#### 로깅 주의사항

| 항목 | 설명 |
|------|------|
| 민감 정보 | 패스워드, 카드번호 로깅 금지 |
| 개인정보 | 필요시 마스킹 |
| 로그 보호 | 접근 제어, 무결성 보장 |
| 로그 분석 | 실시간 모니터링, SIEM 연동 |

---

## 언어별 시큐어 코딩

### Java 시큐어 코딩

#### SQL Injection 방지

```java
// PreparedStatement 사용
String sql = "SELECT * FROM users WHERE username = ? AND password = ?";
PreparedStatement stmt = conn.prepareStatement(sql);
stmt.setString(1, username);
stmt.setString(2, password);
ResultSet rs = stmt.executeQuery();
```

#### XSS 방지

```java
// OWASP ESAPI 사용
import org.owasp.esapi.ESAPI;

String safe = ESAPI.encoder().encodeForHTML(userInput);
```

#### 안전한 파일 처리

```java
// 경로 조작 방지
String filename = FilenameUtils.getName(userInput); // 경로 제거
Path path = Paths.get(uploadDir, filename).normalize();

if (!path.startsWith(uploadDir)) {
    throw new SecurityException("Path traversal detected");
}
```

### Python 시큐어 코딩

#### SQL Injection 방지

```python
# 파라미터화된 쿼리
cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))

# ORM 사용 (Django)
User.objects.filter(id=user_id)

# SQLAlchemy
session.query(User).filter(User.id == user_id)
```

#### XSS 방지

```python
# Django 템플릿 자동 이스케이프
{{ user_input }}  # 자동 이스케이프

# 명시적 이스케이프
from django.utils.html import escape
safe = escape(user_input)

# Flask
from markupsafe import escape
safe = escape(user_input)
```

#### 안전한 역직렬화

```python
# 취약: pickle 사용
import pickle
data = pickle.loads(user_input)  # 위험!

# 안전: JSON 사용
import json
data = json.loads(user_input)
```

### JavaScript/Node.js 시큐어 코딩

#### SQL Injection 방지

```javascript
// 파라미터화된 쿼리 (MySQL)
connection.query('SELECT * FROM users WHERE id = ?', [userId], callback);

// Prepared Statement (PostgreSQL)
client.query('SELECT * FROM users WHERE id = $1', [userId]);

// ORM 사용 (Sequelize)
User.findOne({ where: { id: userId } });
```

#### XSS 방지

```javascript
// DOM 조작 시 텍스트로 처리
element.textContent = userInput;  // 안전
element.innerHTML = userInput;     // 위험!

// 라이브러리 사용
const sanitizeHtml = require('sanitize-html');
const clean = sanitizeHtml(dirty);
```

#### 프로토타입 오염 방지

```javascript
// 취약
function merge(target, source) {
    for (let key in source) {
        target[key] = source[key];  // __proto__ 조작 가능
    }
}

// 안전
function merge(target, source) {
    for (let key in source) {
        if (source.hasOwnProperty(key) && key !== '__proto__' && key !== 'constructor') {
            target[key] = source[key];
        }
    }
}
```

### PHP 시큐어 코딩

#### SQL Injection 방지

```php
// PDO Prepared Statement
$stmt = $pdo->prepare('SELECT * FROM users WHERE id = :id');
$stmt->execute(['id' => $userId]);

// mysqli Prepared Statement
$stmt = $mysqli->prepare('SELECT * FROM users WHERE id = ?');
$stmt->bind_param('i', $userId);
$stmt->execute();
```

#### XSS 방지

```php
// HTML 인코딩
echo htmlspecialchars($userInput, ENT_QUOTES, 'UTF-8');

// HTML Purifier 라이브러리
$config = HTMLPurifier_Config::createDefault();
$purifier = new HTMLPurifier($config);
$clean = $purifier->purify($dirty);
```

#### 파일 업로드 보안

```php
// 확장자 검증
$allowedExtensions = ['jpg', 'png', 'gif'];
$extension = strtolower(pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION));
if (!in_array($extension, $allowedExtensions)) {
    die('Invalid file type');
}

// MIME 타입 검증
$finfo = new finfo(FILEINFO_MIME_TYPE);
$mimeType = $finfo->file($_FILES['file']['tmp_name']);
if (!in_array($mimeType, ['image/jpeg', 'image/png', 'image/gif'])) {
    die('Invalid file type');
}
```

---

## 보안 테스트

### 테스트 유형

| 유형 | 설명 |
|------|------|
| SAST | 정적 분석 (소스코드) |
| DAST | 동적 분석 (실행 중) |
| IAST | 대화형 분석 (런타임) |
| SCA | 소프트웨어 구성 분석 |
| 침투 테스트 | 실제 공격 시뮬레이션 |

### SAST (Static Application Security Testing)

| 도구 | 언어 |
|------|------|
| SonarQube | 다중 언어 |
| Checkmarx | 다중 언어 |
| Fortify | 다중 언어 |
| FindBugs/SpotBugs | Java |
| Bandit | Python |
| ESLint + Security | JavaScript |

### DAST (Dynamic Application Security Testing)

| 도구 | 설명 |
|------|------|
| OWASP ZAP | 오픈소스 웹 스캐너 |
| Burp Suite | 웹 보안 테스트 |
| Acunetix | 상용 웹 스캐너 |
| Nikto | 웹 서버 스캐너 |

### SCA (Software Composition Analysis)

| 도구 | 설명 |
|------|------|
| OWASP Dependency-Check | 오픈소스 |
| Snyk | 취약 라이브러리 탐지 |
| Black Duck | 상용 SCA |
| WhiteSource | 상용 SCA |

---

## 시큐어 코딩 표준

### OWASP 시큐어 코딩 가이드

| 항목 | 설명 |
|------|------|
| 입력 검증 | 모든 입력 데이터 검증 |
| 출력 인코딩 | 컨텍스트에 맞는 인코딩 |
| 인증/세션 | 안전한 인증 및 세션 관리 |
| 접근 제어 | 적절한 권한 검증 |
| 암호화 | 안전한 암호화 적용 |
| 에러 처리 | 안전한 에러 처리 |
| 로깅 | 보안 이벤트 로깅 |

### 행정안전부 시큐어 코딩 가이드

| 분류 | 항목 수 |
|------|---------|
| 입력 데이터 검증 및 표현 | 15개 |
| 보안 기능 | 16개 |
| 시간 및 상태 | 2개 |
| 에러 처리 | 3개 |
| 코드 오류 | 4개 |
| 캡슐화 | 5개 |
| API 오용 | 2개 |

### 주요 취약점 (행안부 기준)

| 취약점 | 설명 |
|--------|------|
| SQL 삽입 | 동적 쿼리에 외부 입력값 |
| 크로스사이트 스크립트 | XSS 취약점 |
| 운영체제 명령어 삽입 | OS 명령어 주입 |
| 위험한 형식 파일 업로드 | 악성 파일 업로드 |
| 신뢰되지 않는 URL 주소 | 오픈 리다이렉트 |
| 하드코드된 중요정보 | 소스코드 내 민감정보 |
| 취약한 암호화 알고리즘 | 안전하지 않은 암호화 |

---

## DevSecOps

### DevSecOps 개요

| 항목 | 설명 |
|------|------|
| 정의 | DevOps에 보안 통합 |
| 원칙 | Shift Left (보안을 개발 초기로) |
| 자동화 | 보안 테스트 자동화 |

### CI/CD 보안 통합

| 단계 | 보안 활동 |
|------|----------|
| 커밋 | 비밀 스캔, 린팅 |
| 빌드 | SAST, SCA |
| 테스트 | DAST, 보안 테스트 |
| 배포 | 컨테이너 스캔, 설정 검증 |
| 운영 | 모니터링, 취약점 관리 |

### 보안 자동화 도구

| 용도 | 도구 |
|------|------|
| 비밀 스캔 | GitLeaks, TruffleHog |
| 컨테이너 스캔 | Trivy, Clair, Anchore |
| IaC 스캔 | Checkov, tfsec |
| SAST 통합 | SonarQube, CodeQL |
| 의존성 스캔 | Dependabot, Snyk |

---

## 용어 해설

| 용어 | 설명 |
|------|------|
| SDLC (Software Development Life Cycle) | 소프트웨어 개발 생명주기. 요구사항부터 유지보수까지의 전체 개발 과정 |
| Secure SDLC | 보안이 통합된 소프트웨어 개발 생명주기. 각 단계에서 보안 활동 수행 |
| 시큐어 코딩 (Secure Coding) | 보안 취약점이 없는 안전한 코드를 작성하는 개발 방법론 |
| MS SDL | Microsoft Security Development Lifecycle. MS가 개발한 보안 개발 프로세스 |
| OWASP SAMM | Software Assurance Maturity Model. 소프트웨어 보안 성숙도 모델 |
| BSIMM | Building Security In Maturity Model. 소프트웨어 보안 측정 프레임워크 |
| 위협 모델링 (Threat Modeling) | 시스템의 보안 위협을 체계적으로 식별하고 대응방안을 수립하는 활동 |
| STRIDE | MS의 위협 분류 모델. Spoofing, Tampering, Repudiation, Information Disclosure, DoS, Elevation of Privilege |
| DREAD | 위험도 평가 모델. Damage, Reproducibility, Exploitability, Affected Users, Discoverability |
| DFD (Data Flow Diagram) | 데이터 흐름도. 위협 모델링에서 시스템 구조 파악에 사용 |
| 화이트리스트 (Whitelist) | 허용된 값만 승인하는 검증 방식. 블랙리스트보다 안전 |
| 블랙리스트 (Blacklist) | 금지된 값만 차단하는 검증 방식. 우회 가능성 존재 |
| 출력 인코딩 (Output Encoding) | XSS 방지를 위해 출력 시 특수문자를 안전하게 변환하는 기법 |
| ESAPI | Enterprise Security API. OWASP에서 제공하는 보안 기능 라이브러리 |
| bcrypt | 패스워드 해시 알고리즘. 솔트와 작업 계수를 포함하여 무차별 대입 공격에 강함 |
| Argon2 | 현재 가장 권장되는 패스워드 해시 알고리즘. Password Hashing Competition 우승 |
| PBKDF2 | Password-Based Key Derivation Function 2. 반복 해시를 통한 키 유도 함수 |
| SecureRandom | 암호학적으로 안전한 난수를 생성하는 클래스. 세션 ID, 토큰 생성에 사용 |
| IDOR (Insecure Direct Object Reference) | 안전하지 않은 직접 객체 참조. 권한 검증 없이 객체에 직접 접근 가능한 취약점 |
| Shift Left | 보안 활동을 개발 초기 단계로 앞당기는 DevSecOps 원칙 |
| SAST (Static Application Security Testing) | 정적 분석. 소스코드를 실행하지 않고 분석하여 취약점 탐지 |
| DAST (Dynamic Application Security Testing) | 동적 분석. 실행 중인 애플리케이션을 테스트하여 취약점 탐지 |
| IAST (Interactive Application Security Testing) | 대화형 분석. 런타임에 에이전트를 통해 취약점 탐지 |
| SCA (Software Composition Analysis) | 소프트웨어 구성 분석. 오픈소스 라이브러리의 알려진 취약점 탐지 |
| SonarQube | 코드 품질 및 보안 분석 도구. 다중 언어 지원 |
| Snyk | 오픈소스 취약점 탐지 및 수정 도구. SCA 및 컨테이너 스캔 제공 |
| DevSecOps | DevOps에 보안을 통합한 개발운영 방법론. 자동화된 보안 테스트 강조 |
| CI/CD (Continuous Integration/Delivery) | 지속적 통합 및 배포. 코드 변경을 자동으로 빌드, 테스트, 배포 |
| GitLeaks | Git 저장소에서 비밀(API 키, 패스워드)을 탐지하는 도구 |
| Trivy | 컨테이너 이미지와 파일시스템의 취약점을 스캔하는 도구 |
| 프로토타입 오염 (Prototype Pollution) | JavaScript에서 __proto__를 조작하여 객체의 프로토타입을 오염시키는 취약점 |
| 역직렬화 (Deserialization) | 직렬화된 데이터를 객체로 변환하는 과정. 안전하지 않은 역직렬화는 RCE 가능 |
| pickle | Python의 직렬화 모듈. 신뢰할 수 없는 데이터에 사용 시 코드 실행 위험 |
| ORM (Object-Relational Mapping) | 객체와 관계형 DB 테이블을 매핑하는 기술. SQL Injection 방지에 도움 |

---

## 핵심 키워드

`Secure SDLC` `MS SDL` `위협 모델링` `STRIDE` `DREAD` `시큐어 코딩` `입력 검증` `출력 인코딩` `Prepared Statement` `세션 관리` `접근 제어` `암호화` `SAST` `DAST` `SCA` `OWASP` `DevSecOps`
